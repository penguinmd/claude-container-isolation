# Alpine 3.19 Base Image for Claude Code CLI
# Provides a minimal, lightweight environment with fast startup times

FROM alpine:3.19

# Set environment variables
ENV LANG=C.UTF-8 \
    LC_ALL=C.UTF-8 \
    USER=claude \
    HOME=/home/claude

# Install system dependencies and Claude Code CLI
RUN apk add --no-cache \
    # Core utilities
    curl \
    wget \
    git \
    vim \
    nano \
    sudo \
    ca-certificates \
    # Build tools
    build-base \
    # Compression tools
    unzip \
    zip \
    tar \
    # Shell
    bash \
    # Network tools
    netcat-openbsd \
    iputils \
    # Process monitoring
    procps \
    # GNU compatibility
    coreutils

# Install Claude Code CLI
RUN curl -fsSL https://claude.ai/install.sh | bash

# Optional language runtimes (commented out by default)
# Uncomment the sections below to enable specific language support

# # Python 3.12
# RUN apk add --no-cache \
#     python3 \
#     py3-pip

# # Node.js 20.x LTS
# RUN apk add --no-cache \
#     nodejs \
#     npm

# # Go 1.21
# RUN apk add --no-cache \
#     go

# # Rust
# RUN apk add --no-cache \
#     rust \
#     cargo

# # Java (OpenJDK 21)
# RUN apk add --no-cache \
#     openjdk21

# # Ruby 3.2
# RUN apk add --no-cache \
#     ruby \
#     ruby-dev

# Create non-root user
RUN adduser -D -s /bin/bash ${USER} && \
    echo "${USER} ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Set up working directory
WORKDIR ${HOME}

# Switch to non-root user
USER ${USER}

# Default command - keep container running for detached mode
# Use tail instead of bash so container doesn't exit when run with -d flag
CMD ["tail", "-f", "/dev/null"]

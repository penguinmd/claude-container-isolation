# Debian 12 (Bookworm) Base Image for Claude Code CLI
# Provides a stable, well-supported environment with excellent compatibility

FROM debian:12

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive \
    LANG=C.UTF-8 \
    LC_ALL=C.UTF-8 \
    USER=claude \
    HOME=/home/claude

# Install system dependencies and Claude Code CLI
RUN apt-get update && apt-get install -y \
    # Core utilities
    curl \
    wget \
    git \
    vim \
    nano \
    sudo \
    ca-certificates \
    gnupg \
    lsb-release \
    # Build tools
    build-essential \
    # Compression tools
    unzip \
    zip \
    tar \
    # Network tools
    netcat-openbsd \
    iputils-ping \
    # Process monitoring
    procps \
    # Clean up
    && rm -rf /var/lib/apt/lists/*

# Install Claude Code CLI
RUN curl -fsSL https://claude.ai/install.sh | bash

# Optional language runtimes (commented out by default)
# Uncomment the sections below to enable specific language support

# # Python 3.11
# RUN apt-get update && apt-get install -y \
#     python3 \
#     python3-pip \
#     python3-venv \
#     && rm -rf /var/lib/apt/lists/*

# # Node.js 20.x LTS
# RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
#     && apt-get install -y nodejs \
#     && rm -rf /var/lib/apt/lists/*

# # Go 1.21
# RUN wget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz \
#     && tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz \
#     && rm go1.21.0.linux-amd64.tar.gz
# ENV PATH=$PATH:/usr/local/go/bin

# # Rust
# RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
# ENV PATH="/root/.cargo/bin:${PATH}"

# # Java (OpenJDK 17)
# RUN apt-get update && apt-get install -y \
#     openjdk-17-jdk \
#     && rm -rf /var/lib/apt/lists/*

# # Ruby 3.1
# RUN apt-get update && apt-get install -y \
#     ruby-full \
#     && rm -rf /var/lib/apt/lists/*

# Create non-root user
RUN useradd -m -s /bin/bash ${USER} && \
    echo "${USER} ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Set up working directory
WORKDIR ${HOME}

# Switch to non-root user
USER ${USER}

# Default command - keep container running for detached mode
# Use tail instead of bash so container doesn't exit when run with -d flag
CMD ["tail", "-f", "/dev/null"]
